{{ define "main" }}
<!-- Author Header -->
<div class="author-profile-header">

  {{ $imageURL := .Params.avatar }}
  {{ $imagePath := path.Join "../" $imageURL }}

  <div class="container author-profile-content">
    <a href="{{ "/autores/" | relURL }}" class="back-link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12,19 5,12 12,5"/></svg>
      Volver a autores
    </a>

    <div class="author-profile-grid">
      <div class="author-profile-left">
        <div class="author-profile-image">
          <img src="{{ $imagePath }}" alt="{{ .Title }}">
        </div>
        <div class="author-profile-info">
          <h1>{{ .Title }}</h1>
          <p class="role">{{ .Params.role }}</p>

          <div class="author-profile-social">
            {{ with .Params.twitter }}
            <a href="https://twitter.com/{{ strings.TrimPrefix "@" . }}" target="_blank" rel="noopener noreferrer" class="author-profile-social-link">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/></svg>
              <span>{{ . }}</span>
            </a>
            {{ end }}
            {{ with .Params.linkedin }}
            <a href="https://linkedin.com/in/{{ . }}" target="_blank" rel="noopener noreferrer" class="author-profile-social-link">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
              <span>LinkedIn</span>
            </a>
            {{ end }}
          </div>
        </div>
      </div>

      <div class="author-profile-right">
        <p class="bio">{{ .Params.bio | markdownify }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Author's Articles -->
<div class="container py-12">
  {{ $authorSlug := .File.ContentBaseName }}
  {{ $authorArticles := where (where .Site.RegularPages "Section" "articulos") ".Params.authorSlug" $authorSlug }}
  {{ $authorMagazines := where (where .Site.RegularPages "Section" "revistas") ".Params.authorSlug" $authorSlug }}
  {{ $allContent := union $authorArticles $authorMagazines }}
  
  {{ if $allContent }}
  <section class="mb-12">
    <h2 class="mb-6 text-gray-900">Artículos</h2>
    <div class="grid grid-cols-1 md-grid-cols-2 lg-grid-cols-3 gap-6">
      {{ range $allContent }}
        {{ $imageURL := .Params.image }}
        {{ if eq .Section "revistas" }}
          {{ $imageURL = replace .Params.image ".." "" }}
          {{ $imageURL = print "../../revistas/" .Params.magazineSlug $imageURL }}
        {{ end }}
        <a href="{{ .Permalink }}" class="article-card">
          <div class="article-card-image">
            <img src="{{ $imageURL }}" alt="{{ .Title }}">
          </div>
          <div class="article-card-content">
            <h3 class="article-card-title">{{ .Title }}</h3>
            <p class="article-card-excerpt">{{ .Params.excerpt }}</p>
            <div class="article-card-meta">
              {{ if not .Date.IsZero }}
              <div class="article-card-meta-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                <span>{{ .Date.Format "2 January 2006" }}</span>
              </div>
              {{ end }}
              {{ with .Params.magazineSlug }}
                {{ $parts := split . "-" }}
                {{ $number := index $parts 1 }}  
                <div class="article-card-meta-item">
                  <span class="magazine-badge" style="position: static;">Nº {{ $number }}</span>
                </div>
              {{ end }}
            </div>
          </div>
        </a>
      {{ end }}
    </div>
  </section>
  {{ end }}

  {{ if not $allContent }}
  <div class="text-center py-12 text-gray-500">
    <p>Este autor aún no tiene artículos publicados.</p>
  </div>
  {{ end }}
</div>
{{ end }}
